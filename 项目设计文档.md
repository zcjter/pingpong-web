# 乒乓球比赛管理系统 - 项目设计文档

## 1. 系统架构设计

### 1.1 整体架构

本系统采用前后端分离的B/S架构：

```
┌─────────────────────────────────────────────────────────────┐
│                        前端 (Frontend)                        │
│                   HTML + CSS + JavaScript                    │
│                     Element UI 组件库                         │
└─────────────────────────────────────────────────────────────┘
                              │
                         HTTP REST API
                              │
┌─────────────────────────────────────────────────────────────┐
│                        后端 (Backend)                         │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    Controller 层                         ││
│  │  PlayerController / MatchController / CompetitionController ││
│  │  AnnouncementController / PlayerRankingController        ││
│  └─────────────────────────────────────────────────────────┘│
│                              │                                │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    Service 层                            ││
│  │  PlayerService / MatchService / CompetitionService        ││
│  │  AnnouncementService / PlayerRankingService              ││
│  └─────────────────────────────────────────────────────────┘│
│                              │                                │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                   Mapper (Repository) 层                ││
│  │  JpaRepository / 自定义查询方法                          ││
│  └─────────────────────────────────────────────────────────┘│
│                              │                                │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                    Entity 实体类                         ││
│  │  Player / Match / Competition / Announcement / PlayerRanking ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      MySQL 数据库                            │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 技术选型

| 层次 | 技术 | 版本 |
|------|------|------|
| 后端框架 | Spring Boot | 2.7.14 |
| 数据访问 | Spring Data JPA | - |
| 数据库 | MySQL | 8.0+ |
| 构建工具 | Maven | 3.6+ |
| 前端框架 | 原生 HTML/CSS/JS | - |
| UI组件库 | Element UI | - |
| Java版本 | JDK | 11 |

---

## 2. 数据库设计

### 2.1 ER图关系

```
┌──────────────┐       ┌──────────────┐
│   players    │       │ competitions │
├──────────────┤       ├──────────────┤
│ id (PK)      │       │ id (PK)      │
│ name         │       │ name         │
│ country      │       │ start_date   │
│ age          │       │ end_date     │
│ gender       │       │ location     │
│ ranking_points│      │ description  │
│ avatar       │       │ is_active    │
│ introduction │       │ competition_year│
│ created_at   │       │ created_at   │
│ updated_at   │       └──────┬───────┘
└──────────────┘              │
       │                     │
       │          ┌──────────┴──────────┐
       │          │      matches        │
       │          ├─────────────────────┤
       │          │ id (PK)             │
       └─────────►│ competition_id (FK) │
                  │ player1_id           │
                  │ player1_name        │
                  │ player1_country     │
                  │ player2_id          │
                  │ player2_name        │
                  │ player2_country     │
                  │ scores (JSON)       │
                  │ player1_total       │
                  │ player2_total       │
                  │ venue               │
                  │ match_date          │
                  │ status              │
                  │ remark              │
                  │ round_number        │
                  │ category            │
                  │ created_at          │
                  │ updated_at          │
                  └─────────────────────┘

┌────────────────────┐     ┌────────────────────┐
│ announcements      │     │ player_rankings    │
├────────────────────┤     ├────────────────────┤
│ id (PK)            │     │ id (PK)            │
│ title              │     │ player_id          │
│ content            │     │ player_name        │
│ type               │     │ country            │
│ is_published       │     │ ranking            │
│ created_at         │     │ points             │
│ updated_at         │     │ category           │
└────────────────────┘     │ ranking_year       │
                            │ created_at         │
                            └────────────────────┘
```

### 2.2 详细表结构

#### 2.2.1 运动员表 (players)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 主键 |
| name | VARCHAR(100) | NOT NULL | 运动员姓名 |
| country | VARCHAR(50) | - | 国家/地区 |
| age | INT | - | 年龄 |
| gender | VARCHAR(10) | - | 性别 |
| ranking_points | INT | DEFAULT 0 | 排名积分 |
| avatar | VARCHAR(500) | - | 头像URL |
| introduction | TEXT | - | 个人简介 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 2.2.2 赛事表 (competitions)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 主键 |
| name | VARCHAR(200) | NOT NULL | 赛事名称 |
| start_date | DATETIME | - | 开始日期 |
| end_date | DATETIME | - | 结束日期 |
| location | VARCHAR(200) | - | 比赛地点 |
| description | TEXT | - | 赛事描述 |
| is_active | BOOLEAN | DEFAULT TRUE | 是否进行中 |
| competition_year | INT | - | 赛事年份 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

#### 2.2.3 比赛记录表 (matches)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 主键 |
| competition_id | BIGINT | FK -> competitions(id) | 所属赛事 |
| player1_id | BIGINT | - | 选手1 ID |
| player1_name | VARCHAR(100) | - |  |
| player1选手1姓名_country | VARCHAR(50) | - | 选手1国家 |
| player2_id | BIGINT | - | 选手2 ID |
| player2_name | VARCHAR(100) | - | 选手2姓名 |
| player2_country | VARCHAR(50) | - | 选手2国家 |
| scores | JSON | - | 各局比分 JSON格式 |
| player1_total | INT | - | 选手1总得分 |
| player2_total | INT | - | 选手2总得分 |
| venue | VARCHAR(200) | - | 比赛场馆 |
| match_date | DATETIME | - | 比赛日期 |
| status | VARCHAR(20) | DEFAULT 'scheduled' | 比赛状态 |
| remark | TEXT | - | 备注 |
| round_number | VARCHAR(50) | - | 轮次 |
| category | VARCHAR(50) | - | 项目类别 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**status 状态说明**：
- `scheduled` - 已安排
- `ongoing` - 进行中
- `completed` - 已完成
- `cancelled` - 已取消

**category 项目类别**：
- 男单、女单
- 男双、女双、混双
- 男团、女团

**scores JSON 格式示例**：
```json
[
  {"p1": 11, "p2": 8},
  {"p1": 9, "p2": 11},
  {"p1": 11, "p2": 5},
  {"p1": 11, "p2": 7}
]
```

#### 2.2.4 公告表 (announcements)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 主键 |
| title | VARCHAR(200) | NOT NULL | 公告标题 |
| content | TEXT | - | 公告内容 |
| type | VARCHAR(50) | DEFAULT 'general' | 公告类型 |
| is_published | BOOLEAN | DEFAULT TRUE | 是否发布 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**type 类型说明**：
- `news` - 新闻
- `notice` - 通知
- `system` - 系统

#### 2.2.5 年度排名表 (player_rankings)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 主键 |
| player_id | BIGINT | - | 运动员ID |
| player_name | VARCHAR(100) | - | 运动员姓名 |
| country | VARCHAR(50) | - | 国家 |
| ranking | INT | - | 排名 |
| points | INT | - | 积分 |
| category | VARCHAR(50) | - | 项目类别 |
| ranking_year | INT | - | 排名年份 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

---

## 3. 后端设计

### 3.1 包结构

```
com.pingpong/
├── PingPongApplication.java          # 启动类
├── controller/                       # REST API控制器
│   ├── PlayerController.java
│   ├── MatchController.java
│   ├── CompetitionController.java
│   ├── AnnouncementController.java
│   └── PlayerRankingController.java
├── service/                          # 业务逻辑层
│   ├── PlayerService.java
│   ├── MatchService.java
│   ├── CompetitionService.java
│   ├── AnnouncementService.java
│   └── PlayerRankingService.java
├── mapper/                           # 数据访问层 (Repository)
│   ├── PlayerRepository.java
│   ├── MatchRepository.java
│   ├── CompetitionRepository.java
│   ├── AnnouncementRepository.java
│   └── PlayerRankingRepository.java
└── entity/                           # 实体类
    ├── Player.java
    ├── Match.java
    ├── Competition.java
    ├── Announcement.java
    └── PlayerRanking.java
```

### 3.2 Controller 设计

#### 3.2.1 PlayerController

```java
@RestController
@RequestMapping("/api/players")
@CrossOrigin(origins = "*")
public class PlayerController {
    // 获取所有运动员
    GetMapping -> List<Player> getAllPlayers()
    
    // 按排名获取运动员
    GetMapping("/ranking") -> List<Player> getPlayersByRanking()
    
    // 获取单个运动员
    GetMapping("/{id}") -> ResponseEntity<Player> getPlayerById(id)
    
    // 搜索运动员
    GetMapping("/search") -> List<Player> searchPlayers(keyword)
    
    // 创建运动员
    PostMapping -> Player createPlayer(player)
    
    // 更新运动员
    PutMapping("/{id}") -> ResponseEntity<Player> updatePlayer(id, player)
    
    // 删除运动员
    DeleteMapping("/{id}") -> ResponseEntity<Void> deletePlayer(id)
    
    // 更新积分
    PutMapping("/{id}/ranking") -> ResponseEntity<Player> updateRanking(id, points)
}
```

#### 3.2.2 MatchController

```java
@RestController
@RequestMapping("/api/matches")
@CrossOrigin(origins = "*")
public class MatchController {
    // 获取所有比赛
    GetMapping -> List<Match> getAllMatches()
    
    // 获取单个比赛
    GetMapping("/{id}") -> ResponseEntity<Match> getMatchById(id)
    
    // 按状态筛选
    GetMapping("/status/{status}") -> List<Match> getMatchesByStatus(status)
    
    // 获取赛事下的比赛
    GetMapping("/competition/{competitionId}") -> List<Match> getMatchesByCompetition(competitionId)
    
    // 创建比赛
    PostMapping -> Match createMatch(match)
    
    // 更新比赛
    PutMapping("/{id}") -> ResponseEntity<Match> updateMatch(id, match)
    
    // 删除比赛
    DeleteMapping("/{id}") -> ResponseEntity<Void> deleteMatch(id)
}
```

#### 3.2.3 CompetitionController

```java
@RestController
@RequestMapping("/api/competitions")
@CrossOrigin(origins = "*")
public class CompetitionController {
    // 获取所有赛事
    GetMapping -> List<Competition> getAllCompetitions()
    
    // 获取活跃赛事
    GetMapping("/active") -> List<Competition> getActiveCompetitions()
    
    // 获取单个赛事
    GetMapping("/{id}") -> ResponseEntity<Competition> getCompetitionById(id)
    
    // 创建赛事
    PostMapping -> Competition createCompetition(competition)
    
    // 更新赛事
    PutMapping("/{id}") -> ResponseEntity<Competition> updateCompetition(id, competition)
    
    // 删除赛事
    DeleteMapping("/{id}") -> ResponseEntity<Void> deleteCompetition(id)
}
```

#### 3.2.4 AnnouncementController

```java
@RestController
@RequestMapping("/api/announcements")
@CrossOrigin(origins = "*")
public class AnnouncementController {
    // 获取所有公告
    GetMapping -> List<Announcement> getAllAnnouncements()
    
    // 获取已发布公告
    GetMapping("/published") -> List<Announcement> getPublishedAnnouncements()
    
    // 获取单个公告
    GetMapping("/{id}") -> ResponseEntity<Announcement> getAnnouncementById(id)
    
    // 创建公告
    PostMapping -> Announcement createAnnouncement(announcement)
    
    // 更新公告
    PutMapping("/{id}") -> ResponseEntity<Announcement> updateAnnouncement(id, announcement)
    
    // 删除公告
    DeleteMapping("/{id}") -> ResponseEntity<Void> deleteAnnouncement(id)
}
```

#### 3.2.5 PlayerRankingController

```java
@RestController
@RequestMapping("/api/rankings")
@CrossOrigin(origins = "*")
public class PlayerRankingController {
    // 获取所有排名
    GetMapping -> List<PlayerRanking> getAllRankings()
    
    // 获取年份列表
    GetMapping("/years") -> List<Integer> getYears()
    
    // 按年份获取排名
    GetMapping("/year/{year}") -> List<PlayerRanking> getRankingsByYear(year)
    
    // 按年份+项目获取排名
    GetMapping("/year/{year}/category/{category}") -> List<PlayerRanking> getRankingsByYearAndCategory(year, category)
    
    // 按项目获取排名
    GetMapping("/category/{category}") -> List<PlayerRanking> getRankingsByCategory(category)
    
    // 获取单条排名
    GetMapping("/{id}") -> ResponseEntity<PlayerRanking> getRankingById(id)
    
    // 创建排名
    PostMapping -> PlayerRanking createRanking(ranking)
    
    // 更新排名
    PutMapping("/{id}") -> ResponseEntity<PlayerRanking> updateRanking(id, ranking)
    
    // 删除排名
    DeleteMapping("/{id}") -> ResponseEntity<Void> deleteRanking(id)
}
```

### 3.3 Service 设计原则

1. **单一职责**：每个Service类只负责一个业务领域
2. **事务管理**：使用 `@Transactional` 注解保证数据一致性
3. **依赖注入**：通过 `@Autowired` 注入Repository层

### 3.4 Repository 设计

使用 Spring Data JPA 的 `JpaRepository` 作为基础接口：

```java
public interface PlayerRepository extends JpaRepository<Player, Long> {
    // 根据姓名模糊搜索
    List<Player> findByNameContaining(String name);
    
    // 按积分降序排序
    @Query("SELECT p FROM Player p ORDER BY p.rankingPoints DESC")
    List<Player> findAllOrderByRankingPointsDesc();
}
```

---

## 4. 前端设计

### 4.1 页面结构

```
index.html
├── 头部 Header
│   └── 项目标题 "乒乓球比赛管理系统"
├── 导航栏 Nav
│   ├── 首页
│   ├── 著名运动员
│   ├── 赛事管理
│   ├── 排名管理
│   └── 赛事冠军
└── 主体内容 Container
    ├── page-home (首页)
    │   ├── 最新公告列表
    │   └── 各项目排名TOP 3
    ├── page-players (运动员管理)
    │   ├── 运动员列表视图
    │   └── 运动员详情视图
    ├── page-competitions (赛事管理)
    │   ├── 赛事列表视图
    │   └── 赛事详情视图
    ├── page-ranking-manage (排名管理)
    ├── page-champions (赛事冠军)
    └── page-announcement (公告详情)
```

### 4.2 核心功能流程

#### 4.2.1 运动员管理流程

```
加载页面 → fetch('/api/players') → 渲染卡片列表
    ↓
点击卡片 → fetch('/api/players/{id}') → 渲染详情页
    ↓
点击编辑 → 弹出模态框 → form提交 → PUT /api/players/{id}
    ↓
点击删除 → confirm确认 → DELETE /api/players/{id}
```

#### 4.2.2 比赛管理流程

```
选择赛事 → fetch('/api/competitions/{id}/matches') → 渲染比赛列表
    ↓
添加比赛 → 弹出模态框 → 选择选手/输入比分 → POST /api/matches
    ↓
编辑比赛 → 弹出预填模态框 → form提交 → PUT /api/matches/{id}
```

### 4.3 API 通信

```javascript
const API_BASE = 'http://localhost:8090/api';

// GET 请求
async function getPlayers() {
    const res = await fetch(`${API_BASE}/players`);
    return await res.json();
}

// POST 请求
async function createPlayer(player) {
    const res = await fetch(`${API_BASE}/players`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(player)
    });
    return await res.json();
}
```

---

## 5. 安全与性能设计

### 5.1 CORS 跨域配置

```java
@CrossOrigin(origins = "*")  // 允许所有来源跨域
```

### 5.2 数据校验

- 前端：必填字段使用 HTML5 `required` 属性
- 后端：JPA 自动进行基本数据类型校验

### 5.3 性能优化

1. **数据库索引**：为常用查询字段建立索引
   - `players.name`
   - `matches.competition_id`
   - `player_rankings.ranking_year + category`

2. **前端优化**：
   - 使用 CSS 类控制显示/隐藏，减少DOM操作
   - 列表数据使用卡片式展示

---

## 6. 部署配置

### 6.1 后端配置 (application.yml)

```yaml
server:
  port: 8090

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/pingpong
    username: root
    password: root
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
```

### 6.2 前端配置

```javascript
const API_BASE = 'http://localhost:8090/api';
```

---

## 7. 扩展性设计

### 7.1 模块化设计

- 各模块独立Controller/Service/Repository，便于维护和扩展
- 实体类使用 Lombok 减少样板代码

### 7.2 预留扩展点

1. **赛事类型扩展**：category 字段可添加更多项目类型
2. **用户系统**：可后期添加用户认证与权限管理
3. **文件上传**：avatar 字段支持头像上传功能

---

## 8. 开发规范

### 8.1 命名规范

- **Controller**：以 `Controller` 结尾
- **Service**：以 `Service` 结尾
- **Repository**：以 `Repository` 结尾
- **Entity**：使用业务含义名称

### 8.2 RESTful 规范

| 方法 | 用途 | 幂等性 |
|------|------|--------|
| GET | 查询 | 幂等 |
| POST | 创建 | 非幂等 |
| PUT | 更新 | 幂等 |
| DELETE | 删除 | 幂等 |

### 8.3 代码风格

- 使用 Lombok 注解简化代码
- Service 层添加事务注解
- Controller 层统一返回格式
